---
// @ts-nocheck
import Console from "@console";
import Section from "@components/Section.astro";

---

<Console title="Themes Library">
    <Section>
        <h1 class="text-xl">Upload VScode theme</h1>
        <input type="file" id="file" accept=".json,.vstheme,application/json,application/xml"/>
        <p> You can run the command "Developer: Generate Color Theme From Current Settings" in VScode to generate a theme file from you current theme.</p> 
    </Section>

    <script type="module">
        function adjust(color, amount) {
            return '#' + color.replace(/^#/, '').replace(/../g, color => ('0'+Math.min(255, Math.max(0, parseInt(color, 16) + amount)).toString(16)).substr(-2));
        }
        const fileInput = document.getElementById("file")
        fileInput.addEventListener("change", (e) => {
            const file = e.target.files[0];
            const reader = new FileReader();
            reader.onload = (event) => {
                const fileContent = event.target.result;
                const theme = JSON.parse(fileContent);
                console.log(theme);

                const colors = Object.entries(theme.colors).map(([name, value]) => ({ name, value }));

                const activityBarBackground = colors.find(color => color.name === "activityBar.background")
                const sideBarBackground = colors.find(color => color.name === "sideBar.background")
                const foreground = colors.find(color => color.name === "foreground")
                const buttonBackground = colors.find(color => color.name === "button.background")

                const settings2 = adjust(sideBarBackground.value, -10)
                const settings3 = adjust(sideBarBackground.value, -20)

                document.documentElement.style.setProperty('--primary-bg-color', activityBarBackground.value);
                localStorage.setItem('primary-bg-color', activityBarBackground.value);
                document.documentElement.style.setProperty('--secondary-bg-color', adjust(activityBarBackground.value, -50));
                localStorage.setItem('secondary-bg-color', adjust(activityBarBackground.value, -50));
                document.documentElement.style.setProperty('--settings-1', sideBarBackground.value);
                localStorage.setItem('settings-1', sideBarBackground.value);
                document.documentElement.style.setProperty('--settings-2', settings2);
                localStorage.setItem('settings-2', settings2);
                document.documentElement.style.setProperty('--settings-3', settings3);
                localStorage.setItem('settings-3', settings3);
                document.documentElement.style.setProperty('--font-color', foreground.value);
                localStorage.setItem('font-color', foreground.value);
                document.documentElement.style.setProperty('--primary-text-color', foreground.value);
                localStorage.setItem('primary-text-color', foreground.value);
                document.documentElement.style.setProperty('--nav-btn-color-darker', adjust(foreground.value, -30));
                localStorage.setItem('nav-btn-color-darker', adjust(foreground.value, -30));
                document.documentElement.style.setProperty('--nav-btn-color', adjust(buttonBackground.value, 20));
                localStorage.setItem('nav-btn-color', adjust(buttonBackground.value, 20));
                localStorage.setItem('theme', 'custom');
                
            }
            reader.readAsText(file);
        });
    </script>
</Console>
